set(IONE_ASAN 0)
set(IONE_UBSAN 0)
set(IONE_LSAN 0)
set(IONE_TSAN 0)
set(IONE_MEMSAN 0)

if (ASAN IN_LIST IONE_FLAGS)
  set(IONE_SAN 1)
  set(IONE_ASAN 1)
  include(ione_asan)
endif ()
if (UBSAN IN_LIST IONE_FLAGS)
  set(IONE_SAN 1)
  set(IONE_UBSAN 1)
  include(ione_ubsan)
endif ()
if (LSAN IN_LIST IONE_FLAGS)
  set(IONE_SAN 1)
  set(IONE_LSAN 1)
  include(ione_lsan)
endif ()
if (TSAN IN_LIST IONE_FLAGS)
  set(IONE_SAN 1)
  set(IONE_TSAN 1)
  include(ione_tsan)
endif ()
if (MEMSAN IN_LIST IONE_FLAGS)
  set(IONE_SAN 1)
  set(IONE_MEMSAN 1)
  include(ione_memsan)
endif ()
if (IONE_SAN AND NOT CMAKE_CXX_COMPILER_ID STREQUAL "MSVC" AND NOT CMAKE_CXX_SIMULATE_ID STREQUAL "MSVC")
  # Nicer stack trace and recover
  list(APPEND IONE_COMPILE_OPTIONS -fno-omit-frame-pointer)
endif ()

set(IONE_COVERAGE 0)
if (COVERAGE IN_LIST IONE_FLAGS)
  set(IONE_COVERAGE 1)
  list(APPEND IONE_LINK_OPTIONS --coverage)
  list(APPEND IONE_COMPILE_OPTIONS --coverage)
  list(APPEND IONE_DEFINITIONS NDEBUG)
endif ()


set(IONE_FUTEX 0) # TODO(kononovk) Fucking atomic::wait bugged

if (DISABLE_SYMMETRIC_TRANSFER IN_LIST IONE_FLAGS)
  set(IONE_SYMMETRIC_TRANSFER 0)
  set(IONE_FINAL_SUSPEND_TRANSFER 0)
elseif (DISABLE_FINAL_SUSPEND_TRANSFER IN_LIST IONE_FLAGS)
  set(IONE_SYMMETRIC_TRANSFER 1)
  set(IONE_FINAL_SUSPEND_TRANSFER 0)
else ()
  set(IONE_SYMMETRIC_TRANSFER 1)
  set(IONE_FINAL_SUSPEND_TRANSFER 1)
endif ()

if (ERROR IN_LIST IONE_LOG)
  list(APPEND IONE_DEFINITIONS IONE_LOG_ERROR)
endif ()
if (WARN IN_LIST IONE_LOG)
  list(APPEND IONE_DEFINITIONS IONE_LOG_WARN)
endif ()
if (DEBUG IN_LIST IONE_LOG)
  list(APPEND IONE_DEFINITIONS IONE_LOG_DEBUG)
endif ()
